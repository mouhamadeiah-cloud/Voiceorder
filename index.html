<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoiceOrder - Kellner Seite</title>
    <!-- Google Fonts und Font Awesome -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <style>
        /* ŸÜŸÅÿ≥ ÿßŸÑÿ™ÿµŸÖŸäŸÖ ÿßŸÑÿ≥ÿßÿ®ŸÇ ŸÖÿπ ÿ•ÿ∂ÿßŸÅÿ© ÿ®ÿπÿ∂ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: #0a0a0a;
            color: #ffffff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 16px;
        }

        .app-container {
            max-width: 1200px;
            width: 100%;
            background-color: #121212;
            border-radius: 32px;
            padding: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8), 0 0 0 1px #2a2a2a inset;
        }

        /* ÿ±ÿ£ÿ≥ ÿßŸÑÿµŸÅÿ≠ÿ© - ÿ¨ÿØŸäÿØ */
        .header-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 10px;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-title i {
            font-size: 2rem;
            color: #00e676;
        }

        .header-title h2 {
            font-size: 1.8rem;
            font-weight: 600;
            color: #ffffff;
        }

        .header-buttons {
            display: flex;
            gap: 15px;
        }

        .header-btn {
            padding: 12px 25px;
            border-radius: 50px;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.5);
        }

        .btn-kitchen {
            background: #7c4dff;
            color: white;
            box-shadow: 0 5px 0 #4a2b9e;
        }
        .btn-kitchen:hover {
            background: #6b3fe0;
        }

        .btn-call {
            background: #ffb300;
            color: #121212;
            box-shadow: 0 5px 0 #b27100;
        }
        .btn-call:hover {
            background: #e6a200;
        }
        .btn-call i {
            animation: ring 2s infinite;
        }

        @keyframes ring {
            0% { transform: rotate(0deg); }
            10% { transform: rotate(15deg); }
            20% { transform: rotate(-15deg); }
            30% { transform: rotate(10deg); }
            40% { transform: rotate(-10deg); }
            50% { transform: rotate(5deg); }
            60% { transform: rotate(-5deg); }
            70% { transform: rotate(0deg); }
            100% { transform: rotate(0deg); }
        }

        /* Aufnahmebereich */
        .recording-section {
            background: #1e1e1e;
            border-radius: 28px;
            padding: 28px;
            margin-bottom: 28px;
            border: 1px solid #333;
        }

        .record-control {
            display: flex;
            justify-content: center;
            margin-bottom: 24px;
        }

        .record-btn {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border: 3px solid #00e676;
            color: #00e676;
            font-size: 2.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 0 #00803b;
        }

        .record-btn.recording {
            border-color: #ff5252;
            color: #ff5252;
            box-shadow: 0 0 20px #ff5252, 0 6px 0 #a10000;
            animation: pulse 1.2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 15px #ff5252, 0 6px 0 #a10000; }
            50% { box-shadow: 0 0 35px #ff5252, 0 6px 0 #a10000; }
            100% { box-shadow: 0 0 15px #ff5252, 0 6px 0 #a10000; }
        }

        .text-display-area {
            background: #2a2a2a;
            border-radius: 24px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #444;
        }

        .transcript-text {
            font-size: 1.8rem;
            font-weight: 600;
            color: #e0e0e0;
            min-height: 120px;
            word-wrap: break-word;
            background: #1a1a1a;
            padding: 20px;
            border-radius: 16px;
            border-left: 5px solid #00e676;
            line-height: 1.6;
            cursor: pointer;
            transition: 0.2s;
        }
        .transcript-text:hover {
            background: #252525;
            border-left-color: #ffb300;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 28px;
            border-radius: 50px;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.5);
        }

        .btn i { font-size: 1.2rem; }

        .btn-cancel {
            background: #ff3d3d;
            color: white;
            box-shadow: 0 5px 0 #a10000;
        }
        .btn-add {
            background: #00e676;
            color: #121212;
            box-shadow: 0 5px 0 #00803b;
        }
        .btn-continue {
            background: #7c4dff;
            color: white;
            box-shadow: 0 5px 0 #4a2b9e;
        }
        .btn-send {
            background: #00e676;
            color: #121212;
            font-size: 1.4rem;
            padding: 18px 36px;
            box-shadow: 0 6px 0 #00803b;
            width: 100%;
        }
        .btn-send i {
            font-size: 1.5rem;
        }

        /* Warenkorb */
        .cart-section {
            background: #1e1e1e;
            border-radius: 28px;
            padding: 24px;
            border: 1px solid #333;
        }

        .cart-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .cart-header h2 {
            font-size: 1.8rem;
            font-weight: 600;
            color: #00e676;
        }

        .cart-header i {
            font-size: 2rem;
            color: #00e676;
        }

        .cart-items {
            min-height: 150px;
            max-height: 350px;
            overflow-y: auto;
            padding: 12px;
            background: #151515;
            border-radius: 24px;
            margin-bottom: 20px;
        }

        .cart-item {
            background: #252525;
            border-radius: 18px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 6px solid #ffb300;
            transition: 0.2s;
        }
        .cart-item:nth-child(even) { border-left-color: #7c4dff; }
        .cart-item:nth-child(odd) { border-left-color: #ffb300; }

        .item-text {
            flex-grow: 1;
            font-weight: 500;
            font-size: 1.1rem;
            padding: 0 12px;
            color: #ffffff;
        }

        .item-actions {
            display: flex;
            gap: 8px;
        }

        .item-btn {
            background: #3a3a3a;
            border: none;
            color: white;
            width: 42px;
            height: 42px;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.2s;
            font-size: 1rem;
        }
        .item-btn.edit-btn { background: #ffb300; color: black; }
        .item-btn.delete-btn { background: #ff3d3d; }
        .item-btn:hover { opacity: 0.9; transform: scale(0.98); }

        /* Modal Fenster */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.95);
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(8px);
        }

        .modal-content {
            background: #1e1e1e;
            padding: 35px;
            border-radius: 40px;
            width: 90%;
            max-width: 500px;
            border: 2px solid #00e676;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.8);
        }

        .modal-content h2 {
            color: #00e676;
            margin-bottom: 25px;
            text-align: center;
            font-size: 2rem;
        }

        .modal-content h3 {
            color: #ffffff;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5rem;
        }

        .modal-input {
            width: 100%;
            padding: 16px;
            font-size: 1.2rem;
            border-radius: 20px;
            border: 2px solid #444;
            background: #2a2a2a;
            color: white;
            margin-bottom: 20px;
        }
        .modal-input:focus {
            border-color: #00e676;
            outline: none;
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .modal-btn {
            padding: 14px 28px;
            border-radius: 30px;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            flex: 1;
        }
        .modal-btn-save {
            background: #00e676;
            color: #121212;
        }
        .modal-btn-cancel {
            background: #ff3d3d;
            color: white;
        }

        /* Tisch-Modal */
        .table-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            margin: 25px 0;
        }

        .table-btn {
            background: #2a2a2a;
            border: 2px solid #444;
            color: white;
            padding: 16px 5px;
            border-radius: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }
        .table-btn:hover { 
            background: #00e676; 
            color: black; 
            border-color: #00e676; 
        }
        
        .takeaway-btn {
            background: #7c4dff;
            border: none;
            color: white;
            padding: 16px;
            border-radius: 30px;
            font-size: 1.4rem;
            width: 100%;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 12px;
            transition: 0.2s;
        }
        .takeaway-btn:hover {
            background: #6b3fe0;
        }

        .modal-close {
            background: none;
            border: 1px solid #444;
            color: white;
            padding: 14px;
            border-radius: 30px;
            width: 100%;
            font-size: 1.1rem;
            cursor: pointer;
            transition: 0.2s;
        }
        .modal-close:hover {
            background: #2a2a2a;
        }

        /* Edit Keyboard */
        #editKeyboard {
            width: 100%;
            padding: 16px;
            font-size: 1.5rem;
            border-radius: 20px;
            border: 2px solid #00e676;
            background: #2a2a2a;
            color: white;
            margin-top: 20px;
        }

        .cart-badge {
            background: #00e676;
            color: #121212;
            border-radius: 30px;
            padding: 4px 12px;
            font-size: 1rem;
            font-weight: bold;
            margin-left: 10px;
        }

        /* Toast Benachrichtigung */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #00e676;
            color: #121212;
            padding: 16px 32px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 600;
            box-shadow: 0 10px 30px rgba(0, 230, 118, 0.3);
            z-index: 2000;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                bottom: 0;
                opacity: 0;
            }
            to {
                bottom: 30px;
                opacity: 1;
            }
        }

        .click-hint {
            font-size: 0.9rem;
            color: #888;
            margin-top: 8px;
            text-align: center;
        }
        .click-hint i {
            color: #00e676;
            margin-right: 5px;
        }
    </style>
</head>
<body>
<div class="app-container">
    <!-- ÿ±ÿ£ÿ≥ ÿßŸÑÿµŸÅÿ≠ÿ© ŸÖÿπ ÿßŸÑÿ≤ÿ±ŸäŸÜ ÿßŸÑÿ¨ÿØŸäÿØŸäŸÜ -->
    <div class="header-actions">
        <div class="header-title">
            <i class="fas fa-microphone-alt"></i>
            <h2>VoiceOrder</h2>
        </div>
        <div class="header-buttons">
            <button class="header-btn btn-kitchen" id="kitchenBtn" title="Zur K√ºchenansicht">
                <i class="fas fa-kitchen-set"></i> K√ºche
            </button>
            <button class="header-btn btn-call" id="callWaiterBtn" title="Kellner rufen">
                <i class="fas fa-bell"></i> Rufen
            </button>
        </div>
    </div>

    <!-- Aufnahmebereich -->
    <div class="recording-section">
        <div class="record-control">
            <button class="record-btn" id="recordBtn" title="Aufnahme starten/stoppen">
                <i class="fas fa-microphone"></i>
            </button>
        </div>

        <div class="text-display-area">
            <div class="transcript-text" id="transcriptDisplay" title="Klicke auf den Text zum Bearbeiten">
                Dr√ºcke auf das Mikrofon und beginne zu sprechen...
            </div>
            <div class="click-hint">
                <i class="fas fa-mouse-pointer"></i> Klicke auf den Text zum Bearbeiten
            </div>
            <input type="text" id="editKeyboard" style="display: none;" placeholder="Text bearbeiten... (Enter zum Best√§tigen)">
        </div>

        <div class="action-buttons">
            <button class="btn btn-cancel" id="cancelTextBtn"><i class="fas fa-times"></i> L√∂schen</button>
            <button class="btn btn-add" id="addToCartBtn"><i class="fas fa-cart-plus"></i> In Warenkorb</button>
            <button class="btn btn-continue" id="continueRecordingBtn"><i class="fas fa-plus-circle"></i> Fortsetzen</button>
        </div>
    </div>

    <!-- Warenkorb -->
    <div class="cart-section">
        <div class="cart-header">
            <i class="fas fa-shopping-basket"></i>
            <h2>Warenkorb <span class="cart-badge" id="cartCount">0</span></h2>
        </div>
        <div class="cart-items" id="cartItems">
            <div style="color: #777; text-align: center; padding: 40px;">Der Warenkorb ist leer</div>
        </div>
        <button class="btn btn-send" id="sendOrderBtn">
            <i class="fas fa-paper-plane"></i> Bestellung an K√ºche senden
        </button>
    </div>
</div>

<!-- Modal f√ºr Tischnummern -->
<div id="tableModal" class="modal">
    <div class="modal-content">
        <h2>Tischnummer w√§hlen</h2>
        <div class="table-grid" id="tableGrid"></div>
        <button class="takeaway-btn" id="takeawayBtn"><i class="fas fa-motorcycle"></i> Takeaway / Mitnahme</button>
        <button class="modal-close" onclick="closeModal('tableModal')"><i class="fas fa-times"></i> Abbrechen</button>
    </div>
</div>

<!-- Modal f√ºr Bearbeitung (f√ºr Warenkorb) -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <h3>Bestellung bearbeiten</h3>
        <input type="text" id="editModalInput" class="modal-input" placeholder="Bestellung eingeben...">
        <div class="modal-buttons">
            <button class="modal-btn modal-btn-save" id="saveEditBtn"><i class="fas fa-save"></i> Speichern</button>
            <button class="modal-btn modal-btn-cancel" onclick="closeModal('editModal')"><i class="fas fa-times"></i> Abbrechen</button>
        </div>
    </div>
</div>

<script>
    // -------------------- Daten und Variablen --------------------
    let cart = [];                 // Warenkorb Array
    let finalText = '';            // Speichert den finalen Text
    let isRecording = false;       // Aufnahmestatus
    let recognition;               // Speech Recognition Objekt
    let isEditMode = false;        // Bearbeitungsmodus
    let ignoreOnEnd = false;       // Steuerung f√ºr onEnd
    let currentEditIndex = -1;     // Aktueller Bearbeitungsindex

    // ==================== üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥ ====================
    // ====================        ŸáŸÄŸÄŸÄŸÄŸÄŸÄŸÜÿß ÿ™ŸÄŸÄÿ∂ŸÄŸÄÿπ ÿ±ÿßÿ®ŸÄŸÄÿ∑ Firebase       ====================
    // ==================== üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥ ====================
    
const firebaseConfig = {
  apiKey: "AIzaSyBixb8qkMJuJLWkCMHjJYeAMR9mu_qDSEk",
  authDomain: "restaurantsysteme-eaff6.firebaseapp.com",
  databaseURL: "https://restaurantsysteme-eaff6-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "restaurantsysteme-eaff6",
  storageBucket: "restaurantsysteme-eaff6.firebasestorage.app",
  messagingSenderId: "891911663005",
  appId: "1:891911663005:web:85672b40c90c158c2ad374"
};
    
    // ==================== üî¥ ÿßŸÜÿ™ŸáŸâ ŸÖŸÉÿßŸÜ Ÿàÿ∂ÿπ ÿßŸÑÿ±ÿßÿ®ÿ∑ üî¥ ====================

    // Firebase initialisieren
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // -------------------- DOM Elemente --------------------
    const recordBtn = document.getElementById('recordBtn');
    const transcriptDisplay = document.getElementById('transcriptDisplay');
    const editKeyboard = document.getElementById('editKeyboard');
    const cartDiv = document.getElementById('cartItems');
    const cartCount = document.getElementById('cartCount');
    const tableModal = document.getElementById('tableModal');
    const editModal = document.getElementById('editModal');
    const editModalInput = document.getElementById('editModalInput');
    const tableGrid = document.getElementById('tableGrid');

    // -------------------- Funktion f√ºr Sounds --------------------
    function playNotificationSound(type = 'order') {
        try {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            
            if (type === 'order') {
                // ÿµŸàÿ™ ŸàÿµŸàŸÑ ÿ∑ŸÑÿ® ÿ¨ÿØŸäÿØ (ŸÜÿ∫ŸÖÿ™ÿßŸÜ)
                const oscillator1 = audioCtx.createOscillator();
                const gainNode1 = audioCtx.createGain();
                oscillator1.type = 'sine';
                oscillator1.frequency.value = 800;
                gainNode1.gain.value = 0.5;
                oscillator1.connect(gainNode1);
                gainNode1.connect(audioCtx.destination);
                oscillator1.start();
                oscillator1.stop(audioCtx.currentTime + 0.3);

                setTimeout(() => {
                    const oscillator2 = audioCtx.createOscillator();
                    const gainNode2 = audioCtx.createGain();
                    oscillator2.type = 'sine';
                    oscillator2.frequency.value = 1200;
                    gainNode2.gain.value = 0.5;
                    oscillator2.connect(gainNode2);
                    gainNode2.connect(audioCtx.destination);
                    oscillator2.start();
                    oscillator2.stop(audioCtx.currentTime + 0.3);
                }, 200);
            } 
            else if (type === 'call') {
                // ÿµŸàÿ™ ŸÖŸÜÿßÿØÿßÿ© ÿßŸÑŸÜÿßÿØŸÑ (ŸÜÿ∫ŸÖÿ© ÿ´ŸÑÿßÿ´Ÿäÿ©)
                const oscillator1 = audioCtx.createOscillator();
                const gainNode1 = audioCtx.createGain();
                oscillator1.type = 'triangle';
                oscillator1.frequency.value = 600;
                gainNode1.gain.value = 0.4;
                oscillator1.connect(gainNode1);
                gainNode1.connect(audioCtx.destination);
                oscillator1.start();
                oscillator1.stop(audioCtx.currentTime + 0.2);

                setTimeout(() => {
                    const oscillator2 = audioCtx.createOscillator();
                    const gainNode2 = audioCtx.createGain();
                    oscillator2.type = 'triangle';
                    oscillator2.frequency.value = 800;
                    gainNode2.gain.value = 0.4;
                    oscillator2.connect(gainNode2);
                    gainNode2.connect(audioCtx.destination);
                    oscillator2.start();
                    oscillator2.stop(audioCtx.currentTime + 0.2);
                }, 300);

                setTimeout(() => {
                    const oscillator3 = audioCtx.createOscillator();
                    const gainNode3 = audioCtx.createGain();
                    oscillator3.type = 'triangle';
                    oscillator3.frequency.value = 1000;
                    gainNode3.gain.value = 0.4;
                    oscillator3.connect(gainNode3);
                    gainNode3.connect(audioCtx.destination);
                    oscillator3.start();
                    oscillator3.stop(audioCtx.currentTime + 0.2);
                }, 600);
            }
        } catch (e) {
            console.log('Audio nicht unterst√ºtzt', e);
        }
    }

    // -------------------- Speech Recognition Initialisierung --------------------
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.lang = 'de-DE';
        recognition.continuous = true;
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;

        recognition.onstart = function() {
            isRecording = true;
            recordBtn.classList.add('recording');
            recordBtn.innerHTML = '<i class="fas fa-stop"></i>';
        };

        recognition.onend = function() {
            isRecording = false;
            recordBtn.classList.remove('recording');
            recordBtn.innerHTML = '<i class="fas fa-microphone"></i>';
            
            if (!ignoreOnEnd) {
                if (!finalText) {
                    transcriptDisplay.innerText = 'Dr√ºcke auf das Mikrofon und beginne zu sprechen...';
                }
            }
            ignoreOnEnd = false;
        };

        recognition.onresult = function(event) {
            for (let i = event.resultIndex; i < event.results.length; i++) {
                const transcript = event.results[i][0].transcript;
                
                if (finalText) {
                    finalText = finalText + ' ' + transcript;
                } else {
                    finalText = transcript;
                }
                
                transcriptDisplay.innerText = finalText;
            }
        };

        recognition.onerror = function(event) {
            console.error('Spracherkennungsfehler:', event.error);
            let errorMessage = 'Fehler: ';
            switch(event.error) {
                case 'no-speech':
                    errorMessage += 'Keine Sprache erkannt.';
                    break;
                case 'audio-capture':
                    errorMessage += 'Mikrofon nicht gefunden.';
                    break;
                case 'not-allowed':
                    errorMessage += 'Mikrofonzugriff verweigert.';
                    break;
                default:
                    errorMessage += event.error;
            }
            showToast(errorMessage, 'error');
            isRecording = false;
            recordBtn.classList.remove('recording');
            recordBtn.innerHTML = '<i class="fas fa-microphone"></i>';
        };
    } else {
        alert('Ihr Browser unterst√ºtzt keine Spracherkennung. Bitte verwenden Sie Chrome oder Edge.');
    }

    // -------------------- Toast Benachrichtigung --------------------
    function showToast(message, type = 'success') {
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.style.background = type === 'success' ? '#00e676' : '#ff3d3d';
        toast.style.color = type === 'success' ? '#121212' : 'white';
        toast.textContent = message;
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.remove();
        }, 2000);
    }

    // -------------------- Modal Funktionen --------------------
    function openModal(modalId) {
        document.getElementById(modalId).style.display = 'flex';
    }

    window.closeModal = function(modalId) {
        document.getElementById(modalId).style.display = 'none';
    };

    // -------------------- Aufnahme Steuerung --------------------
    function toggleRecording() {
        if (!recognition) return;

        if (isRecording) {
            recognition.stop();
        } else {
            recognition.start();
        }
    }

    // -------------------- Event Listener --------------------
    recordBtn.addEventListener('click', toggleRecording);

    transcriptDisplay.addEventListener('click', function() {
        if (!finalText.trim()) {
            showToast('Kein Text zum Bearbeiten vorhanden!', 'error');
            return;
        }
        editKeyboard.style.display = 'block';
        editKeyboard.value = finalText;
        transcriptDisplay.style.display = 'none';
        isEditMode = true;
        editKeyboard.focus();
    });

    editKeyboard.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            finalText = editKeyboard.value;
            transcriptDisplay.innerText = finalText;
            transcriptDisplay.style.display = 'block';
            editKeyboard.style.display = 'none';
            isEditMode = false;
        }
    });

    editKeyboard.addEventListener('blur', function() {
        if (isEditMode) {
            transcriptDisplay.style.display = 'block';
            editKeyboard.style.display = 'none';
            isEditMode = false;
        }
    });

    document.getElementById('cancelTextBtn').addEventListener('click', function() {
        finalText = '';
        transcriptDisplay.innerText = 'Dr√ºcke auf das Mikrofon und beginne zu sprechen...';
        editKeyboard.style.display = 'none';
        editKeyboard.value = '';
        isEditMode = false;
    });

    document.getElementById('addToCartBtn').addEventListener('click', function() {
        if (!finalText.trim()) {
            showToast('Bitte zuerst einen Text aufnehmen oder eingeben!', 'error');
            return;
        }
        cart.push(finalText.trim());
        updateCartDisplay();
        finalText = '';
        transcriptDisplay.innerText = 'Dr√ºcke auf das Mikrofon und beginne zu sprechen...';
        showToast('Bestellung zum Warenkorb hinzugef√ºgt');
    });

    document.getElementById('continueRecordingBtn').addEventListener('click', function() {
        if (!recognition) return;
        if (!isRecording) {
            ignoreOnEnd = true;
            recognition.start();
        } else {
            showToast('Aufnahme l√§uft bereits.', 'error');
        }
    });

    // -------------------- ÿ≤ÿ± K√ºche (ŸÑŸÑŸÅÿ™ÿ≠ ÿµŸÅÿ≠ÿ© ÿßŸÑŸÖÿ∑ÿ®ÿÆ) --------------------
    document.getElementById('kitchenBtn').addEventListener('click', function() {
        window.location.href = 'kitchen.html';  // ÿßŸÅÿ™ÿ≠ ÿµŸÅÿ≠ÿ© ÿßŸÑŸÖÿ∑ÿ®ÿÆ
    });

    // -------------------- ÿ≤ÿ± Rufen (ŸÖŸÜÿßÿØÿßÿ© ÿßŸÑŸÜÿßÿØŸÑ) --------------------
    document.getElementById('callWaiterBtn').addEventListener('click', function() {
        playNotificationSound('call');  // ÿµŸàÿ™ ÿßŸÑŸÖŸÜÿßÿØÿßÿ©
        showToast('üîî Kellner wurde gerufen!');
        
        // ÿßÿÆÿ™Ÿäÿßÿ±Ÿä: ŸäŸÖŸÉŸÜ ÿ≠ŸÅÿ∏ ÿßŸÑŸÜÿØÿßÿ° ŸÅŸä Firebase
        const callData = {
            type: 'call',
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            table: 'all'  // ŸÜÿØÿßÿ° ÿπÿßŸÖ
        };
        
        db.collection('calls').add(callData)
            .then(() => console.log('Call saved'))
            .catch(err => console.log('Call not saved', err));
    });

    // -------------------- Warenkorb Anzeige --------------------
    function updateCartDisplay() {
        cartCount.textContent = cart.length;

        if (cart.length === 0) {
            cartDiv.innerHTML = '<div style="color: #777; text-align: center; padding: 40px;">Der Warenkorb ist leer</div>';
            return;
        }

        let html = '';
        cart.forEach((item, index) => {
            html += `
                <div class="cart-item">
                    <div class="item-text">${item}</div>
                    <div class="item-actions">
                        <button class="item-btn edit-btn" onclick="openEditModal(${index})" title="Bearbeiten"><i class="fas fa-pen"></i></button>
                        <button class="item-btn delete-btn" onclick="deleteCartItem(${index})" title="L√∂schen"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            `;
        });
        cartDiv.innerHTML = html;
    }

    window.openEditModal = function(index) {
        currentEditIndex = index;
        editModalInput.value = cart[index];
        openModal('editModal');
    };

    document.getElementById('saveEditBtn').addEventListener('click', function() {
        const newText = editModalInput.value.trim();
        if (newText) {
            cart[currentEditIndex] = newText;
            updateCartDisplay();
            closeModal('editModal');
            showToast('Bestellung aktualisiert');
        }
    });

    window.deleteCartItem = function(index) {
        cart.splice(index, 1);
        updateCartDisplay();
        showToast('Bestellung entfernt');
    };

    // -------------------- Bestellung senden (mit Firebase) --------------------
    document.getElementById('sendOrderBtn').addEventListener('click', function() {
        if (cart.length === 0) {
            showToast('Der Warenkorb ist leer!', 'error');
            return;
        }
        generateTableButtons();
        openModal('tableModal');
    });

    function generateTableButtons() {
        let buttonsHtml = '';
        for (let i = 1; i <= 15; i++) {
            buttonsHtml += `<button class="table-btn" onclick="selectTable(${i})">${i}</button>`;
        }
        tableGrid.innerHTML = buttonsHtml;
    }

    window.selectTable = function(tableNumber) {
        sendOrderToKitchen(tableNumber);
    };

    document.getElementById('takeawayBtn').addEventListener('click', function() {
        sendOrderToKitchen('takeaway');
    });

    function sendOrderToKitchen(table) {
        const tableText = table === 'takeaway' ? 'Takeaway' : `Tisch ${table}`;
        
        // ÿ™ÿ≠ÿ∂Ÿäÿ± ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿ®
        const orderData = {
            items: [...cart],
            table: table === 'takeaway' ? 0 : table,
            tableDisplay: tableText,
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            status: 'neu',
            createdAt: new Date().toISOString()
        };
        
        // ÿ≠ŸÅÿ∏ ŸÅŸä Firestore
        db.collection('orders').add(orderData)
            .then((docRef) => {
                console.log('Bestellung gespeichert mit ID:', docRef.id);
                playNotificationSound('order');  // üîî ÿµŸàÿ™ ŸàÿµŸàŸÑ ÿßŸÑÿ∑ŸÑÿ®
                showToast(`‚úÖ Bestellung #${docRef.id.slice(-4)} an ${tableText} gesendet!`);
                
                cart = [];
                updateCartDisplay();
                closeModal('tableModal');
            })
            .catch((error) => {
                console.error('Fehler beim Speichern:', error);
                showToast('‚ùå Fehler beim Senden der Bestellung', 'error');
            });
    }

    // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÖŸàÿØÿßŸÑ ÿ®ÿßŸÑŸÜŸÇÿ± ÿÆÿßÿ±ÿ¨ÿßŸã
    window.onclick = function(event) {
        if (event.target === tableModal) {
            closeModal('tableModal');
        }
        if (event.target === editModal) {
            closeModal('editModal');
        }
    };

    updateCartDisplay();
</script>
</body>
</html>
