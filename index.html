<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eiscaf√© Voice Order - Kristina AI</title>
    <style>
        :root {
            --bg-color: #050505;
            --card-bg: #121212;
            --accent: #d4af37;
            --text: #ffffff;
            --success: #28a745;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background-color: var(--bg-color);
            color: var(--text);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        .app-container { display: flex; width: 100%; }

        /* Left Section: Kristina */
        .kristina-section {
            flex: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            border-right: 1px solid #222;
            position: relative;
        }

        .vibe-visualizer {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: radial-gradient(circle, var(--accent) 0%, transparent 75%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            transition: 0.5s ease;
        }

        .vibe-visualizer.listening {
            animation: ripple 1.5s infinite;
            background: radial-gradient(circle, #ff4d4d 0%, transparent 75%);
        }

        @keyframes ripple {
            0% { transform: scale(1); opacity: 0.6; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 0.6; }
        }

        .chat-bubble {
            background: var(--card-bg);
            padding: 20px 30px;
            border-radius: 20px;
            max-width: 80%;
            text-align: center;
            font-size: 1.4rem;
            line-height: 1.5;
            border: 1px solid #333;
            min-height: 80px;
        }

        .controls { margin-top: 40px; }

        .mic-btn {
            background: var(--accent);
            border: none;
            padding: 20px 50px;
            border-radius: 100px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Right Section: Basket */
        .basket-section {
            flex: 1;
            background: var(--card-bg);
            padding: 25px;
            display: flex;
            flex-direction: column;
        }

        .basket-title {
            font-size: 1.8rem;
            margin-bottom: 5px;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 10px;
        }

        #tisch-indicator { color: var(--accent); margin-bottom: 20px; font-weight: bold; }

        .basket-items { flex-grow: 1; overflow-y: auto; }

        .order-item {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 5px solid var(--accent);
            white-space: pre-wrap;
        }

        .send-kitchen-btn {
            background: var(--success);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-size: 1.1rem;
            cursor: pointer;
            margin-top: 20px;
        }

        /* Modal */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: #1a1a1a;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            border: 1px solid var(--accent);
        }

        input {
            background: #000;
            border: 1px solid #444;
            color: white;
            padding: 15px;
            font-size: 1.5rem;
            width: 100px;
            text-align: center;
            border-radius: 10px;
            margin: 20px 0;
        }
    </style>
</head>
<body>

    <div id="tischModal" class="modal">
        <div class="modal-content">
            <h1 style="color:var(--accent)">Eiscaf√© Voice</h1>
            <p>Tischnummer eingeben:</p>
            <input type="number" id="tischInput" min="1" max="50">
            <br>
            <button class="mic-btn" style="margin: auto;" onclick="initApp()">Anwendung starten</button>
        </div>
    </div>

    <div class="app-container">
        <main class="kristina-section">
            <div id="vibe" class="vibe-visualizer">
                <span style="font-size: 3rem;">üç¶</span>
            </div>
            <div id="status" style="margin-bottom: 10px; color: var(--accent);">Kristina ist bereit</div>
            <div id="kristina-text" class="chat-bubble">
                "Hallo! Ich bin Kristina. Was darf ich Ihnen heute aus unserer Eiskarte bringen?"
            </div>
            <div class="controls">
                <button class="mic-btn" id="micBtn">üé§ Sprechen</button>
            </div>
        </main>

        <aside class="basket-section">
            <div class="basket-title">Warenkorb</div>
            <div id="tisch-indicator">Tisch: -</div>
            <div id="cart-container" class="basket-items">
                <p id="empty-cart" style="color:#444">Keine Bestellungen vorhanden.</p>
            </div>
            <button class="send-kitchen-btn" onclick="sendToFirebase()">Bestellung an die K√ºche</button>
        </aside>
    </div>

    <script>
        // üî¥üî¥üî¥ CONFIGURATION üî¥üî¥üî¥
        const GEMINI_API_KEY = "AIzaSyDFetuGDsBvIUmJ-RU-yrr9CwtFRQO4KTU"; // ÿ∂ÿπ ŸÖŸÅÿ™ÿßÿ≠ŸÉ ŸáŸÜÿß
        const FIREBASE_URL = "DEINE_FIREBASE_URL"; // ÿ±ÿßÿ®ÿ∑ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™

        const MENU = `
        Liste der verf√ºgbaren Produkte:
        - Erdbeerbecher (8.50‚Ç¨)
        - Schokobecher (8.50‚Ç¨)
        - Spagettieis (7.50‚Ç¨)
        - Spagett- Erdbeeren (9.00‚Ç¨)
        - Kaffee (3.00‚Ç¨)
        - Cappuccino (3.80‚Ç¨)
        - Tee (2.50‚Ç¨)
        - Eistee Pfirsich (3.50‚Ç¨)
        - Eistee Zitrone (3.50‚Ç¨)
        `;

        let currentTisch = "";
        let chatContext = [
            { role: "user", parts: [{ text: `Du bist Kristina, eine freundliche Kellnerin in einem Eiscaf√©. 
            Hier ist das Men√º: ${MENU}. 
            Deine Aufgabe: 
            1. Begr√º√üe den Gast. 
            2. Nimm Bestellungen nur aus dem Men√º auf. 
            3. Wenn der Gast fertig ist, fasse die Bestellung zusammen und frage nach "OK".
            4. Wenn der Gast "OK" oder "Ja" sagt, antworte NUR mit dem Wort 'ORDER_CONFIRMED' gefolgt von der Liste.` }] }
        ];

        // Speech Recognition Setup
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        recognition.lang = 'de-DE';

        function initApp() {
            currentTisch = document.getElementById('tischInput').value;
            if(!currentTisch) return alert("Bitte Tisch eingeben");
            document.getElementById('tisch-indicator').innerText = "Tisch: " + currentTisch;
            document.getElementById('tischModal').style.display = 'none';
        }

        document.getElementById('micBtn').addEventListener('click', () => {
            recognition.start();
            document.getElementById('vibe').classList.add('listening');
            document.getElementById('status').innerText = "Ich h√∂re zu...";
        });

        recognition.onresult = async (event) => {
            const userInput = event.results[0][0].transcript;
            document.getElementById('vibe').classList.remove('listening');
            document.getElementById('status').innerText = "Kristina denkt nach...";
            
            // Send to Gemini
            await callGemini(userInput);
        };

        async function callGemini(text) {
            chatContext.push({ role: "user", parts: [{ text: text }] });

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: chatContext })
                });

                const data = await response.json();
                const aiResponse = data.candidates[0].content.parts[0].text;
                
                chatContext.push({ role: "model", parts: [{ text: aiResponse }] });
                processResponse(aiResponse);

            } catch (error) {
                console.error("Gemini Error:", error);
            }
        }

        function processResponse(response) {
            if (response.includes("ORDER_CONFIRMED")) {
                const cleanOrder = response.replace("ORDER_CONFIRMED", "").trim();
                updateBasket(cleanOrder);
                document.getElementById('kristina-text').innerText = "Perfekt! Deine Bestellung wurde aufgenommen.";
            } else {
                document.getElementById('kristina-text').innerText = response;
            }
        }

        function updateBasket(summary) {
            const container = document.getElementById('cart-container');
            document.getElementById('empty-cart').style.display = 'none';
            const div = document.createElement('div');
            div.className = 'order-item';
            div.innerHTML = `<strong>Bestellung:</strong><br>${summary}`;
            container.appendChild(div);
        }

        function sendToFirebase() {
            // üî¥ ŸáŸÜÿß Ÿäÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÑŸÅÿßŸäÿ±ÿ®Ÿäÿ≥ ŸÑŸÑŸÖÿ∑ÿ®ÿÆ
            alert("Bestellung an die K√ºche gesendet!");
        }
    </script>
</body>
</html>
