<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üç¶ Die Primel Eiscaf√© - Bestellung</title>
    <style>
        * { box-sizing: border-box; font-family: system-ui, sans-serif; }
        body { margin: 0; background: #f8f5f0; }
        .container { max-width: 600px; margin: 0 auto; padding: 16px; }
        
        .header {
            background: linear-gradient(135deg, #8B4513 0%, #CD853F 100%);
            color: white;
            padding: 24px 16px;
            border-radius: 0 0 30px 30px;
            margin-bottom: 20px;
        }
        
        h1 { margin: 0; font-size: 28px; }
        
        .voice-section {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .mic-button {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #8B4513;
            border: none;
            color: white;
            font-size: 36px;
            cursor: pointer;
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .mic-button.recording {
            background: #e53e3e;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .recognized-text {
            background: #f0f4ff;
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
            font-size: 18px;
            min-height: 150px;
            text-align: left;
            white-space: pre-wrap;
            direction: ltr;
        }
        
        .order-items {
            background: white;
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 20px;
        }
        
        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 8px;
        }
        
        .delete-btn {
            background: #feb2b2;
            color: #c53030;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .send-btn {
            background: #48bb78;
            color: white;
            border: none;
            padding: 16px;
            border-radius: 30px;
            font-size: 18px;
            width: 100%;
            cursor: pointer;
            margin-top: 16px;
        }
        
        .debug-info {
            background: #e2e8f0;
            padding: 8px;
            border-radius: 8px;
            font-size: 12px;
            margin-top: 10px;
            color: #333;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>üç¶ Die Primel Eiscaf√©</h1>
            <div>Sagen Sie einfach, was Sie m√∂chten</div>
        </div>
    </div>
    
    <div class="container">
        <div class="voice-section">
            <button class="mic-button" id="micBtn">üé§</button>
            <p>Tippen Sie auf das Mikrofon und sprechen Sie</p>
            <div class="recognized-text" id="recognizedText">
                üëÜ Hier erscheint Ihre Bestellung
            </div>
            <div class="debug-info" id="debugInfo"></div>
        </div>
        
        <div class="order-items" id="orderSection" style="display: none;">
            <h3>üìã Ihre Bestellung</h3>
            <div id="orderList"></div>
            <div>Gesamt: <span id="totalItems">0</span> Artikel</div>
            <button class="send-btn" id="sendOrderBtn">‚úÖ Bestellung aufgeben</button>
        </div>
    </div>

    <!-- Gemini API -->
    <script src="https://cdn.jsdelivr.net/npm/@google/generative-ai@latest/dist/index.min.js"></script>
    
    <script>
        // ===========================================
        // üî¥ GEMINI KEY - ÿ∂ÿπ ŸÖŸÅÿ™ÿßÿ≠ŸÉ ŸáŸÜÿß
        // ===========================================
        const GEMINI_API_KEY = "AIzaSyDFetuGDs8JqJpWw3XXXXXXXXXXXXX";
        
        // ===========================================
        // üî¥ ŸÇÿßÿ¶ŸÖÿ© ÿ´ÿßÿ®ÿ™ÿ© ŸÖÿπ IDs ŸÉŸÜÿµŸàÿµ
        // ===========================================
        const MENU_ITEMS = [
            { id: "1", name: "Kookiesbecher" },
            { id: "2", name: "Erdbeerbecher" },
            { id: "3", name: "Spaghettieis" },
            { id: "4", name: "Spagetti Erdbeer" },
            { id: "5", name: "Spagetti kiwi" }
        ];
        
        // ===========================================
        // State
        // ===========================================
        let currentOrder = [];
        
        // ÿπÿ±ÿ∂ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿπŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ©
        const menuList = MENU_ITEMS.map(item => item.name).join('\n');
        document.getElementById('recognizedText').innerHTML = 
            '<strong>üìã ÿßŸÑŸÇÿßÿ¶ŸÖÿ©:</strong><br>' + menuList;
        
        // ===========================================
        // Gemini function
        // ===========================================
        async function askGemini(userText) {
            try {
                // Menu als Text f√ºr Gemini
                const menuText = MENU_ITEMS.map(item => 
                    `- ${item.name} (ID: ${item.id})`
                ).join('\n');
                
                const prompt = `
Du bist ein Kellner in "Die Primel Eiscaf√©".
Der Gast sagt: "${userText}"

SPEISEKARTE:
${menuText}

Finde das passendste Gericht.
Bestimme die Menge (standardm√§√üig 1).

Antworte NUR mit JSON: {"id": "die-id", "menge": zahl}
`;

                updateDebug("ü§î Gemini denkt nach...");
                
                const genAI = new GoogleGenerativeAI(GEMINI_API_KEY);
                const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
                
                const result = await model.generateContent(prompt);
                const response = await result.response;
                const text = response.text();
                
                // Clean JSON
                const jsonText = text.replace(/```json|```/g, '').trim();
                console.log("ü§ñ Gemini:", jsonText);
                
                return JSON.parse(jsonText);
                
            } catch (error) {
                console.error("‚ùå Gemini Fehler:", error);
                updateDebug("‚ùå Gemini Fehler: " + error.message);
                return null;
            }
        }
        
        // ===========================================
        // Process Order - ŸÖÿπ ÿ™ÿµÿ≠Ÿäÿ≠ IDs
        // ===========================================
        async function processOrder(text) {
            updateDebug(`üîç Suche nach: "${text}"`);
            
            const result = await askGemini(text);
            
            if (result && result.id) {
                // üî¥ ÿßŸÑŸÖÿ¥ŸÉŸÑÿ© ŸáŸÜÿß: Gemini ŸÇÿØ Ÿäÿ±ÿ¨ÿπ ID ŸÉÿ±ŸÇŸÖ ÿ£Ÿà ŸÜÿµ
                updateDebug(`ü§ñ Gemini sagt: ID=${result.id}, Menge=${result.menge}`);
                
                // üî¥ ÿßŸÑÿ≠ŸÑ: ŸÜÿ≠ŸàŸÑ ÿßŸÑŸÉŸÑ ŸÑŸÜÿµ ŸÑŸÑŸÖŸÇÿßÿ±ŸÜÿ©
                const item = MENU_ITEMS.find(i => String(i.id) === String(result.id));
                
                if (item) {
                    updateDebug(`‚úÖ Gefunden: ${item.name} (ID: ${item.id})`);
                    
                    for (let i = 0; i < (result.menge || 1); i++) {
                        addToOrder(item.id, item.name);
                    }
                    
                    document.getElementById('recognizedText').innerHTML = 
                        `‚úÖ "${text}"<br><small>${item.name} x${result.menge || 1}</small>`;
                } else {
                    updateDebug(`‚ùå Kein Item mit ID ${result.id} gefunden`);
                    document.getElementById('recognizedText').innerHTML = 
                        `‚ùå "${text}"<br><small>Gericht mit ID ${result.id} nicht gefunden</small>`;
                    
                    // ÿπÿ±ÿ∂ ÿßŸÑ IDs ÿßŸÑŸÖÿ™ÿßÿ≠ÿ© ŸÑŸÑŸÖÿ≥ÿßÿπÿØÿ©
                    const availableIds = MENU_ITEMS.map(i => `${i.name} (${i.id})`).join(', ');
                    updateDebug(`Verf√ºgbare IDs: ${availableIds}`);
                }
            } else {
                updateDebug(`‚ùå Gemini konnte kein Gericht zuordnen`);
                document.getElementById('recognizedText').innerHTML = 
                    `‚ùå "${text}"<br><small>Kein passendes Gericht</small>`;
            }
        }
        
        // ===========================================
        // Debug Funktion
        // ===========================================
        function updateDebug(msg) {
            document.getElementById('debugInfo').innerHTML = msg;
            console.log(msg);
        }
        
        // ===========================================
        // Order Management
        // ===========================================
        function addToOrder(itemId, itemName) {
            currentOrder.push({
                id: itemId,
                name: itemName,
                orderId: Date.now() + Math.random()
            });
            updateOrderDisplay();
        }
        
        function removeFromOrder(index) {
            currentOrder.splice(index, 1);
            updateOrderDisplay();
        }
        
        function updateOrderDisplay() {
            const section = document.getElementById('orderSection');
            const list = document.getElementById('orderList');
            const total = document.getElementById('totalItems');
            
            if (currentOrder.length > 0) {
                section.style.display = 'block';
                
                let html = '';
                currentOrder.forEach((item, i) => {
                    html += `
                        <div class="order-item">
                            <span>${item.name}</span>
                            <button class="delete-btn" onclick="removeFromOrder(${i})">‚úï</button>
                        </div>
                    `;
                });
                
                list.innerHTML = html;
                total.textContent = currentOrder.length;
            } else {
                section.style.display = 'none';
            }
        }
        
        // ===========================================
        // Speech Recognition
        // ===========================================
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition = null;
        let isRecording = false;
        
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.lang = 'de-DE';
            recognition.continuous = false;
            recognition.interimResults = true;
            
            recognition.onstart = function() {
                isRecording = true;
                micBtn.classList.add('recording');
                document.getElementById('recognizedText').innerHTML = 'üé§ H√∂re zu...';
                updateDebug('üé§ H√∂re zu...');
            };
            
            recognition.onresult = function(event) {
                let finalText = '';
                for (let i = 0; i < event.results.length; i++) {
                    if (event.results[i].isFinal) {
                        finalText = event.results[i][0].transcript;
                    }
                }
                
                if (finalText) {
                    processOrder(finalText);
                }
            };
            
            recognition.onerror = function() {
                document.getElementById('recognizedText').innerHTML = '‚ùå Fehler beim H√∂ren';
                stopRecording();
            };
            
            recognition.onend = stopRecording;
        }
        
        function startRecording() {
            if (recognition && !isRecording) recognition.start();
        }
        
        function stopRecording() {
            isRecording = false;
            micBtn.classList.remove('recording');
        }
        
        // ===========================================
        // Event Listeners
        // ===========================================
        document.getElementById('micBtn').addEventListener('click', startRecording);
        document.getElementById('sendOrderBtn').addEventListener('click', sendOrder);
        
        window.addToOrder = addToOrder;
        window.removeFromOrder = removeFromOrder;
        
        // Send Order function
        async function sendOrder() {
            if (currentOrder.length === 0) return;
            alert('‚úÖ Bestellung aufgegeben!');
            currentOrder = [];
            updateOrderDisplay();
        }
    </script>
</body>
</html><!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üç¶ Die Primel Eiscaf√© - Bestellung</title>
    <style>
        * { box-sizing: border-box; font-family: system-ui, sans-serif; }
        body { margin: 0; background: #f8f5f0; }
        .container { max-width: 600px; margin: 0 auto; padding: 16px; }
        
        .header {
            background: linear-gradient(135deg, #8B4513 0%, #CD853F 100%);
            color: white;
            padding: 24px 16px;
            border-radius: 0 0 30px 30px;
            margin-bottom: 20px;
        }
        
        h1 { margin: 0; font-size: 28px; }
        
        .voice-section {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .mic-button {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #8B4513;
            border: none;
            color: white;
            font-size: 36px;
            cursor: pointer;
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .mic-button.recording {
            background: #e53e3e;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .recognized-text {
            background: #f0f4ff;
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
            font-size: 18px;
            min-height: 150px;
            text-align: left;
            white-space: pre-wrap;
            direction: ltr;
        }
        
        .order-items {
            background: white;
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 20px;
        }
        
        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 8px;
        }
        
        .delete-btn {
            background: #feb2b2;
            color: #c53030;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .send-btn {
            background: #48bb78;
            color: white;
            border: none;
            padding: 16px;
            border-radius: 30px;
            font-size: 18px;
            width: 100%;
            cursor: pointer;
            margin-top: 16px;
        }
        
        .debug-info {
            background: #e2e8f0;
            padding: 8px;
            border-radius: 8px;
            font-size: 12px;
            margin-top: 10px;
            color: #333;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>üç¶ Die Primel Eiscaf√©</h1>
            <div>Sagen Sie einfach, was Sie m√∂chten</div>
        </div>
    </div>
    
    <div class="container">
        <div class="voice-section">
            <button class="mic-button" id="micBtn">üé§</button>
            <p>Tippen Sie auf das Mikrofon und sprechen Sie</p>
            <div class="recognized-text" id="recognizedText">
                üëÜ Hier erscheint Ihre Bestellung
            </div>
            <div class="debug-info" id="debugInfo"></div>
        </div>
        
        <div class="order-items" id="orderSection" style="display: none;">
            <h3>üìã Ihre Bestellung</h3>
            <div id="orderList"></div>
            <div>Gesamt: <span id="totalItems">0</span> Artikel</div>
            <button class="send-btn" id="sendOrderBtn">‚úÖ Bestellung aufgeben</button>
        </div>
    </div>

    <!-- Gemini API -->
    <script src="https://cdn.jsdelivr.net/npm/@google/generative-ai@latest/dist/index.min.js"></script>
    
    <script>
        // ===========================================
        // üî¥ GEMINI KEY - ÿ∂ÿπ ŸÖŸÅÿ™ÿßÿ≠ŸÉ ŸáŸÜÿß
        // ===========================================
        const GEMINI_API_KEY = "AIzaSyDFetuGDsBvIUmJ-RU-yrr9CwtFRQO4KTU";
        
        // ===========================================
        // üî¥ ŸÇÿßÿ¶ŸÖÿ© ÿ´ÿßÿ®ÿ™ÿ© ŸÖÿπ IDs ŸÉŸÜÿµŸàÿµ
        // ===========================================
        const MENU_ITEMS = [
            { id: "1", name: "Kookiesbecher" },
            { id: "2", name: "Erdbeerbecher" },
            { id: "3", name: "Spaghettieis" },
            { id: "4", name: "Spagetti Erdbeer" },
            { id: "5", name: "Spagetti kiwi" }
        ];
        
        // ===========================================
        // State
        // ===========================================
        let currentOrder = [];
        
        // ÿπÿ±ÿ∂ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿπŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ©
        const menuList = MENU_ITEMS.map(item => item.name).join('\n');
        document.getElementById('recognizedText').innerHTML = 
            '<strong>üìã ÿßŸÑŸÇÿßÿ¶ŸÖÿ©:</strong><br>' + menuList;
        
        // ===========================================
        // Gemini function
        // ===========================================
        async function askGemini(userText) {
            try {
                // Menu als Text f√ºr Gemini
                const menuText = MENU_ITEMS.map(item => 
                    `- ${item.name} (ID: ${item.id})`
                ).join('\n');
                
                const prompt = `
Du bist ein Kellner in "Die Primel Eiscaf√©".
Der Gast sagt: "${userText}"

SPEISEKARTE:
${menuText}

Finde das passendste Gericht.
Bestimme die Menge (standardm√§√üig 1).

Antworte NUR mit JSON: {"id": "die-id", "menge": zahl}
`;

                updateDebug("ü§î Gemini denkt nach...");
                
                const genAI = new GoogleGenerativeAI(GEMINI_API_KEY);
                const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
                
                const result = await model.generateContent(prompt);
                const response = await result.response;
                const text = response.text();
                
                // Clean JSON
                const jsonText = text.replace(/```json|```/g, '').trim();
                console.log("ü§ñ Gemini:", jsonText);
                
                return JSON.parse(jsonText);
                
            } catch (error) {
                console.error("‚ùå Gemini Fehler:", error);
                updateDebug("‚ùå Gemini Fehler: " + error.message);
                return null;
            }
        }
        
        // ===========================================
        // Process Order - ŸÖÿπ ÿ™ÿµÿ≠Ÿäÿ≠ IDs
        // ===========================================
        async function processOrder(text) {
            updateDebug(`üîç Suche nach: "${text}"`);
            
            const result = await askGemini(text);
            
            if (result && result.id) {
                // üî¥ ÿßŸÑŸÖÿ¥ŸÉŸÑÿ© ŸáŸÜÿß: Gemini ŸÇÿØ Ÿäÿ±ÿ¨ÿπ ID ŸÉÿ±ŸÇŸÖ ÿ£Ÿà ŸÜÿµ
                updateDebug(`ü§ñ Gemini sagt: ID=${result.id}, Menge=${result.menge}`);
                
                // üî¥ ÿßŸÑÿ≠ŸÑ: ŸÜÿ≠ŸàŸÑ ÿßŸÑŸÉŸÑ ŸÑŸÜÿµ ŸÑŸÑŸÖŸÇÿßÿ±ŸÜÿ©
                const item = MENU_ITEMS.find(i => String(i.id) === String(result.id));
                
                if (item) {
                    updateDebug(`‚úÖ Gefunden: ${item.name} (ID: ${item.id})`);
                    
                    for (let i = 0; i < (result.menge || 1); i++) {
                        addToOrder(item.id, item.name);
                    }
                    
                    document.getElementById('recognizedText').innerHTML = 
                        `‚úÖ "${text}"<br><small>${item.name} x${result.menge || 1}</small>`;
                } else {
                    updateDebug(`‚ùå Kein Item mit ID ${result.id} gefunden`);
                    document.getElementById('recognizedText').innerHTML = 
                        `‚ùå "${text}"<br><small>Gericht mit ID ${result.id} nicht gefunden</small>`;
                    
                    // ÿπÿ±ÿ∂ ÿßŸÑ IDs ÿßŸÑŸÖÿ™ÿßÿ≠ÿ© ŸÑŸÑŸÖÿ≥ÿßÿπÿØÿ©
                    const availableIds = MENU_ITEMS.map(i => `${i.name} (${i.id})`).join(', ');
                    updateDebug(`Verf√ºgbare IDs: ${availableIds}`);
                }
            } else {
                updateDebug(`‚ùå Gemini konnte kein Gericht zuordnen`);
                document.getElementById('recognizedText').innerHTML = 
                    `‚ùå "${text}"<br><small>Kein passendes Gericht</small>`;
            }
        }
        
        // ===========================================
        // Debug Funktion
        // ===========================================
        function updateDebug(msg) {
            document.getElementById('debugInfo').innerHTML = msg;
            console.log(msg);
        }
        
        // ===========================================
        // Order Management
        // ===========================================
        function addToOrder(itemId, itemName) {
            currentOrder.push({
                id: itemId,
                name: itemName,
                orderId: Date.now() + Math.random()
            });
            updateOrderDisplay();
        }
        
        function removeFromOrder(index) {
            currentOrder.splice(index, 1);
            updateOrderDisplay();
        }
        
        function updateOrderDisplay() {
            const section = document.getElementById('orderSection');
            const list = document.getElementById('orderList');
            const total = document.getElementById('totalItems');
            
            if (currentOrder.length > 0) {
                section.style.display = 'block';
                
                let html = '';
                currentOrder.forEach((item, i) => {
                    html += `
                        <div class="order-item">
                            <span>${item.name}</span>
                            <button class="delete-btn" onclick="removeFromOrder(${i})">‚úï</button>
                        </div>
                    `;
                });
                
                list.innerHTML = html;
                total.textContent = currentOrder.length;
            } else {
                section.style.display = 'none';
            }
        }
        
        // ===========================================
        // Speech Recognition
        // ===========================================
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition = null;
        let isRecording = false;
        
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.lang = 'de-DE';
            recognition.continuous = false;
            recognition.interimResults = true;
            
            recognition.onstart = function() {
                isRecording = true;
                micBtn.classList.add('recording');
                document.getElementById('recognizedText').innerHTML = 'üé§ H√∂re zu...';
                updateDebug('üé§ H√∂re zu...');
            };
            
            recognition.onresult = function(event) {
                let finalText = '';
                for (let i = 0; i < event.results.length; i++) {
                    if (event.results[i].isFinal) {
                        finalText = event.results[i][0].transcript;
                    }
                }
                
                if (finalText) {
                    processOrder(finalText);
                }
            };
            
            recognition.onerror = function() {
                document.getElementById('recognizedText').innerHTML = '‚ùå Fehler beim H√∂ren';
                stopRecording();
            };
            
            recognition.onend = stopRecording;
        }
        
        function startRecording() {
            if (recognition && !isRecording) recognition.start();
        }
        
        function stopRecording() {
            isRecording = false;
            micBtn.classList.remove('recording');
        }
        
        // ===========================================
        // Event Listeners
        // ===========================================
        document.getElementById('micBtn').addEventListener('click', startRecording);
        document.getElementById('sendOrderBtn').addEventListener('click', sendOrder);
        
        window.addToOrder = addToOrder;
        window.removeFromOrder = removeFromOrder;
        
        // Send Order function
        async function sendOrder() {
            if (currentOrder.length === 0) return;
            alert('‚úÖ Bestellung aufgegeben!');
            currentOrder = [];
            updateOrderDisplay();
        }
    </script>
</body>
</html>
